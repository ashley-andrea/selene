# Datasets

Three datasets feed the recommendation and outcome-prediction pipeline.

---

## 1. `data/output/patients_flat.csv`

**Type:** Fully synthetic  
**Size:** 5,147 rows × 46 columns · 1.0 MB

**How it was obtained:**  
Generated with [Synthea](https://github.com/synthetichealth/synthea) (`~/synthea`) restricted to female patients aged 15–50. Five custom FHIR modules were added to simulate conditions underrepresented in the default Synthea population: PCOS, endometriosis, migraine-with-aura, depression/anxiety, and thrombophilia. A post-processing script flattened each patient's condition and observation bundle into a single CSV row.

**Key columns:**

- Demographics: `age`, `race`, `ethnicity`, `income`
- Vitals: `bmi`, `systolic_bp`, `diastolic_bp`, `phq9_score`
- 23 binary condition flags (`cond_migraine_with_aura`, `cond_thrombophilia`, `cond_pcos`, `cond_endometriosis`, `cond_depression`, …)
- `has_absolute_contraindication_combined_ocp` — pre-computed safety flag

**Purpose:** Provides the patient population for counterfactual simulation and serves as the input feature vector for the recommendation model.

---

## 2. `drugs/output/pill_reference_db.csv`

**Type:** Real data (3 public sources)  
**Size:** 9 rows × 48 columns · < 0.1 MB

**How it was obtained:**  
One row per oral contraceptive formulation. Built by `drugs/build_drug_reference.py` from three sources:

| Source                                          | What it contributes                                                                                       | How                                                                                                                            |
| ----------------------------------------------- | --------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| **drugscom reviews** (Kaggle, ~21k OBC reviews) | 18 `kw_*` side-effect frequency rates                                                                     | Keyword counts over patient-written reviews, deflated by 0.60 to correct for negative-reporting bias                           |
| **FDA FAERS** (~88k adverse-event rows)         | 12 `faers_*` serious-event signal counts                                                                  | Drug-name mapping table (42 entries) → reaction aggregation                                                                    |
| **FDA OpenFDA drug labels API**                 | `label_warnings`, `label_contraindications`, `label_adverse_reactions`, `label_boxed_warning` text fields | `openfda.substance_name` query (most ingredients); `openfda.generic_name` required for norgestimate, desogestrel, drospirenone |

**Key columns:**

- Identity: `combo_id`, `pill_type` (combined / progestin-only), `estrogen_dose_mcg`, `progestin_name`, `progestin_dose_mg`, `generation`
- Clinical properties: `androgenic_activity`, `anti_androgenic`, `vte_risk_class`
- Side-effect rates: `kw_nausea`, `kw_headache`, `kw_mood_changes`, `kw_acne_improved`, … (18 total)
- Serious events: `faers_vte_count`, `faers_stroke_count`, … (12 total)
- Label text: `label_warnings`, `label_contraindications`, `label_adverse_reactions`, `label_boxed_warning`

**Purpose:** Pharmacological ground truth. Supplies base rates and clinical properties consumed by the simulation generator and used as a lookup table by the recommendation model.

---

## 3. `data/output/symptom_diaries.csv`

**Type:** Simulated (evidence-based Monte Carlo)  
**Size:** 555,876 rows × 27 columns · 69.6 MB

**How it was obtained:**  
Generated by `data/processing/generate_symptom_diaries.py`. Every patient is paired with all 9 pills for 12 months, producing a counterfactual panel (5,147 × 9 × 12). The simulation has four layers:

1. **WHO MEC classification** — assigns safety category 1–4 per patient-pill pair using WHO Medical Eligibility Criteria 5th ed. rules (age, migraine-with-aura, thrombophilia, hypertension, smoker age ≥35, etc.)
2. **Risk modifiers** — multiplicative adjustments derived from published RRs/HRs: depression → ×2.8 mood; thrombophilia → ×8.4 VTE; migraine+aura → ×6.6 stroke; DRSP progestin → ×0.78 mood; BMI ≥30 → ×2.0 VTE
3. **Temporal symptom curves** — per-symptom resolution/onset profiles over 12 months (e.g., nausea peaks month 1 and resolves by month 3; acne improvement builds through month 6)
4. **Serious event sampling** — annual VTE/stroke rates drawn from Lidegaard BMJ 2012; DVT/PE split conditional on VTE event

Key evidence sources: Lidegaard _BMJ_ 2012 (VTE), Skovlund _JAMA Psychiatry_ 2016 (depression HR), Arowojolu _Cochrane_ 2012 (acne), Bloemenkamp _Lancet_ 1995 (thrombophilia VTE RR), WHO MEC 5th ed. 2015, CDC NSFG 2017–2019 (discontinuation).

**Key columns:**

- `patient_id`, `combo_id`, `month` (1–12)
- `prescription_appropriate`, `who_mec_category` (1–4), `who_mec_reason`
- 14 monthly symptom flags: `sym_nausea`, `sym_headache`, `sym_breast_tenderness`, `sym_spotting`, `sym_mood_worsened`, `sym_depression_episode`, `sym_anxiety`, `sym_libido_decreased`, `sym_weight_gain`, `sym_acne_improved`, `sym_acne_worsened`, `sym_hair_loss`, `sym_cramps_relieved`, `sym_pcos_improvement`
- 3 serious event flags: `evt_dvt`, `evt_pe`, `evt_stroke`
- `still_taking`, `discontinued_reason`, `satisfaction_score` (1–10)

**Purpose:** Benchmark ground truth for the temporal outcome-prediction model. The counterfactual structure — every patient simulated on every pill — enables direct comparison of predicted vs. simulated outcomes across all treatment options.
